<Window x:Class="VPetLLM.UI.Windows.winSettingNew"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:VPetLLM"
        xmlns:utils="clr-namespace:VPetLLM.Utils"
        mc:Ignorable="d"
        Title="VPetLLM"
        Height="833"
        Width="991"
        Background="{DynamicResource BackgroundBrush}">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Styles/Controls.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <utils:BoolInverter x:Key="BoolInverter"/>

            <!-- 现代化TabControl样式 -->
            <Style x:Key="ModernTabControl" TargetType="TabControl">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Padding" Value="0"/>
            </Style>

            <Style x:Key="ModernTabItem" TargetType="TabItem">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="FontWeight" Value="Normal"/>
                <Setter Property="Padding" Value="16,12"/>
                <Setter Property="Margin" Value="0,0,2,0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabItem">
                            <Border Background="{TemplateBinding Background}"
                                    BorderThickness="0,0,0,2"
                                    BorderBrush="Transparent"
                                    CornerRadius="4,4,0,0">
                                <ContentPresenter x:Name="ContentSite"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                ContentSource="Header"
                                                Margin="{TemplateBinding Padding}"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#FFFFFF"/>
                                    <Setter Property="Foreground" Value="#0078D4"/>
                                    <Setter TargetName="ContentSite" Property="TextElement.FontWeight" Value="SemiBold"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#F3F2F1"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- 设置组样式 -->
            <Style x:Key="SettingGroup" TargetType="StackPanel">
                <Setter Property="Margin" Value="0,0,0,20"/>
            </Style>

            <Style x:Key="SettingLabel" TargetType="Label">
                <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="FontWeight" Value="Medium"/>
                <Setter Property="Margin" Value="0,0,0,8"/>
            </Style>

            <!-- 节标题样式 -->
            <Style x:Key="SectionHeader" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Margin" Value="0,0,0,12"/>
            </Style>

            <!-- 描述文本样式 -->
            <Style x:Key="DescriptionText" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}"/>
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="TextWrapping" Value="Wrap"/>
                <Setter Property="LineHeight" Value="18"/>
            </Style>

            <!-- 现代化密码框样式 -->
            <Style x:Key="ModernPasswordBox" TargetType="PasswordBox">
                <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
                <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="12,8"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Height" Value="36"/>
            </Style>

            <!-- DataGrid列头样式 -->
            <Style x:Key="ModernDataGridColumnHeader" TargetType="DataGridColumnHeader">
                <Setter Property="Background" Value="{StaticResource ControlBackgroundBrush}"/>
                <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Padding" Value="12,8"/>
                <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
                <Setter Property="BorderThickness" Value="0,0,1,1"/>
            </Style>
        </ResourceDictionary>
    </Window.Resources>
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TabControl Grid.Row="0" Style="{StaticResource ModernTabControl}">
            <TabItem Header="LLM设置"
                    x:Name="Tab_LLM"
                    Style="{StaticResource ModernTabItem}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <ScrollViewer Grid.Column="0"
                            VerticalScrollBarVisibility="Auto">
                        <Border Style="{StaticResource CardContainer}" Margin="0,0,10,0">
                            <StackPanel Style="{StaticResource SettingGroup}">
                                <Label Content="LLM 提供商"
                                        x:Name="Label_Provider"
                                        Style="{StaticResource SettingLabel}"/>
                                <ComboBox x:Name="ComboBox_Provider"
                                        Margin="0,0,0,16"
                                        SelectionChanged="ComboBox_Provider_SelectionChanged"
                                        Style="{StaticResource ModernComboBox}">
                                    <!-- 简化的ComboBoxItem样式 -->
                                    <ComboBox.ItemContainerStyle>
                                        <Style TargetType="ComboBoxItem" BasedOn="{StaticResource {x:Type ComboBoxItem}}">
                                            <Setter Property="Padding" Value="12,8"/>
                                            <Setter Property="FontSize" Value="14"/>
                                            <Setter Property="ContentTemplate">
                                                <Setter.Value>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <!-- 提供商图标 -->
                                                            <Border x:Name="ItemIcon"
                                                                    Background="{StaticResource AccentBrush}"
                                                                    CornerRadius="3"
                                                                    Width="18"
                                                                    Height="18"
                                                                    Margin="0,0,8,0">
                                                                <TextBlock x:Name="ItemIconText"
                                                                        Text="⚡"
                                                                        FontSize="9"
                                                                        Foreground="White"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                            </Border>
                                                            
                                                            <!-- 提供商名称 -->
                                                            <TextBlock Text="{Binding}"
                                                                    VerticalAlignment="Center"/>
                                                        </StackPanel>
                                                        <DataTemplate.Triggers>
                                                            <!-- 根据不同提供商设置图标 -->
                                                            <DataTrigger Binding="{Binding}" Value="Ollama">
                                                                <Setter TargetName="ItemIconText" Property="Text" Value="O"/>
                                                                <Setter TargetName="ItemIcon" Property="Background" Value="#FF6B35"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding}" Value="OpenAI">
                                                                <Setter TargetName="ItemIconText" Property="Text" Value="AI"/>
                                                                <Setter TargetName="ItemIcon" Property="Background" Value="#10A37F"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding}" Value="Gemini">
                                                                <Setter TargetName="ItemIconText" Property="Text" Value="G"/>
                                                                <Setter TargetName="ItemIcon" Property="Background" Value="#4285F4"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding}" Value="Free">
                                                                <Setter TargetName="ItemIconText" Property="Text" Value="F"/>
                                                                <Setter TargetName="ItemIcon" Property="Background" Value="#28A745"/>
                                                            </DataTrigger>
                                                        </DataTemplate.Triggers>
                                                    </DataTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ComboBox.ItemContainerStyle>
                                </ComboBox>

                                <Label Content="AI名称"
                                        VerticalAlignment="Top"
                                        Margin="0,0,0,0"
                                        x:Name="Label_AiName"
                                        Style="{StaticResource SettingLabel}"/>
                                <TextBox x:Name="TextBox_AiName"
                                         MaxWidth="300"
                                         Margin="0,0,0,16"
                                         Style="{StaticResource ModernTextBox}"
                                         IsEnabled="{Binding IsChecked, ElementName=CheckBox_FollowVPetName, Converter={StaticResource BoolInverter}}"/>
                                <Label Content="用户名称"
                                         VerticalAlignment="Top"
                                         Margin="0,0,0,0"
                                         x:Name="Label_UserName"
                                         Style="{StaticResource SettingLabel}"/>
                                <TextBox x:Name="TextBox_UserName"
                                         MaxWidth="300"
                                         Margin="0,0,0,16"
                                         Style="{StaticResource ModernTextBox}"
                                         IsEnabled="{Binding IsChecked, ElementName=CheckBox_FollowVPetName, Converter={StaticResource BoolInverter}}"/>
                                <CheckBox x:Name="CheckBox_FollowVPetName"
                                        Content="名字与主人名字设置跟着桌面宠物设置"
                                        Margin="0,0,0,16"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <Label Content="角色设定"
                                        VerticalAlignment="Top"
                                        Margin="0,0,0,0"
                                        x:Name="Label_Role"
                                        Style="{StaticResource SettingLabel}"/>
                                <TextBox x:Name="TextBox_Role"
                                        TextWrapping="Wrap"
                                        AcceptsReturn="True"
                                        VerticalScrollBarVisibility="Auto"
                                        HorizontalScrollBarVisibility="Auto"
                                        Height="120"
                                        Width="300"
                                        Margin="0,0,0,16"
                                        Style="{StaticResource ModernTextBox}"/>

                                <Label Content="上下文控制"
                                        Margin="0,0,0,0"
                                        x:Name="Label_ContextControl"
                                        Style="{StaticResource SettingLabel}"/>
                                <CheckBox x:Name="CheckBox_KeepContext"
                                        Content="保持聊天上下文"
                                        Margin="0,0,0,8"
                                        IsChecked="True"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <CheckBox x:Name="CheckBox_EnableChatHistory"
                                        Content="保存聊天历史"
                                        Margin="0,0,0,8"
                                        IsChecked="True"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <CheckBox x:Name="CheckBox_SeparateChatByProvider"
                                        Content="按提供商分离聊天记录"
                                        Margin="0,0,0,16"
                                        IsChecked="True"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <WrapPanel HorizontalAlignment="Right"
                                        Margin="0,0,0,0">
                                    <Button x:Name="Button_ClearContext"
                                            Content="清除上下文"
                                            Click="Button_ClearContext_Click"
                                            Margin="0,0,10,0"
                                            Style="{StaticResource SecondaryButton}"/>
                                    <Button x:Name="Button_EditContext"
                                            Content="编辑上下文"
                                            Click="Button_EditContext_Click"
                                            Style="{StaticResource ModernButton}"/>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                    </ScrollViewer>

                    <TabControl Grid.Column="1">
                        <TabItem Header="Ollama"
                                x:Name="Tab_Ollama"
                                Style="{StaticResource ModernTabItem}">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <Border Style="{StaticResource CardContainer}">
                                    <StackPanel Style="{StaticResource SettingGroup}">
                                        <Label Content="URL"
                                                x:Name="Label_OllamaUrl"
                                                Style="{StaticResource SettingLabel}"/>
                                        <TextBox x:Name="TextBox_OllamaUrl"
                                                Margin="0,0,0,16"
                                                Style="{StaticResource ModernTextBox}"/>
                                        <Label Content="模型"
                                                x:Name="Label_OllamaModel"
                                                Style="{StaticResource SettingLabel}"/>
                                        <Grid Margin="0,0,0,16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <ComboBox x:Name="ComboBox_OllamaModel"
                                                    Grid.Column="0"
                                                    IsEditable="True"
                                                    Style="{StaticResource ModelComboBox}"/>
                                            <Button x:Name="Button_RefreshOllamaModels"
                                                    Grid.Column="1"
                                                    Content="刷新"
                                                    Click="Button_RefreshOllamaModels_Click"
                                                    Margin="10,0,0,0"
                                                    Style="{StaticResource SecondaryButton}"/>
                                        </Grid>
                                        <CheckBox x:Name="CheckBox_Ollama_EnableAdvanced"
                                                Content="启用高级配置"
                                                Margin="0,0,0,16"
                                                Style="{StaticResource ModernCheckBox}"/>
                                        <StackPanel x:Name="StackPanel_Ollama_Advanced"
                                                Margin="20,0,0,0"
                                                IsEnabled="{Binding ElementName=CheckBox_Ollama_EnableAdvanced, Path=IsChecked}">
                                            <StackPanel Orientation="Horizontal"
                                                    Margin="0,0,0,12">
                                                <TextBlock Text="温度:"
                                                        Width="80"
                                                        VerticalAlignment="Center"
                                                        x:Name="TextBlock_Ollama_Temperature"
                                                        Foreground="{StaticResource PrimaryTextBrush}"
                                                        FontSize="14"/>
                                                <Slider x:Name="Slider_Ollama_Temperature"
                                                        Minimum="0"
                                                        Maximum="2"
                                                        Width="125"
                                                        Margin="10,0"
                                                        VerticalAlignment="Center"/>
                                                <TextBlock x:Name="TextBlock_Ollama_TemperatureValue"
                                                        Width="40"
                                                        VerticalAlignment="Center"
                                                        Foreground="{StaticResource SecondaryTextBrush}"
                                                        FontSize="14"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal"
                                                    Margin="0,0,0,0">
                                                <TextBlock Text="最大Token:"
                                                        Width="80"
                                                        VerticalAlignment="Center"
                                                        x:Name="TextBlock_Ollama_MaxTokens"
                                                        Foreground="{StaticResource PrimaryTextBrush}"
                                                        FontSize="14"/>
                                                <TextBox x:Name="TextBox_Ollama_MaxTokens"
                                                        Width="125"
                                                        Margin="10,0"
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource ModernTextBox}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </ScrollViewer>
                        </TabItem>
                        <TabItem Header="OpenAI"
                                x:Name="Tab_OpenAI"
                                Style="{StaticResource ModernTabItem}">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <Border Style="{StaticResource CardContainer}">
                                    <StackPanel Style="{StaticResource SettingGroup}">
                                        <Label Content="API 密钥"
                                                x:Name="Label_OpenAIApiKey"
                                                Style="{StaticResource SettingLabel}"/>
                                        <TextBox x:Name="TextBox_OpenAIApiKey"
                                                Margin="0,0,0,16"
                                                Style="{StaticResource ModernTextBox}"/>
                                        <Label Content="模型"
                                                x:Name="Label_OpenAIModel"
                                                Style="{StaticResource SettingLabel}"/>
                                        <Grid Margin="0,0,0,16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <ComboBox x:Name="ComboBox_OpenAIModel"
                                                    Grid.Column="0"
                                                    IsEditable="True"
                                                    Style="{StaticResource ModelComboBox}"/>
                                            <Button x:Name="Button_RefreshOpenAIModels"
                                                    Grid.Column="1"
                                                    Content="刷新"
                                                    Click="Button_RefreshOpenAIModels_Click"
                                                    Margin="10,0,0,0"
                                                    Style="{StaticResource SecondaryButton}"/>
                                        </Grid>
                                        <Label Content="API 地址"
                                                x:Name="Label_OpenAIUrl"
                                                Style="{StaticResource SettingLabel}"/>
                                        <TextBox x:Name="TextBox_OpenAIUrl"
                                                Margin="0,0,0,16"
                                                Style="{StaticResource ModernTextBox}"/>
                                        <CheckBox x:Name="CheckBox_OpenAI_EnableAdvanced"
                                                Content="启用高级配置"
                                                Margin="0,0,0,16"
                                                Style="{StaticResource ModernCheckBox}"/>
                                        <StackPanel x:Name="StackPanel_OpenAI_Advanced"
                                                Margin="20,0,0,0"
                                                IsEnabled="{Binding ElementName=CheckBox_OpenAI_EnableAdvanced, Path=IsChecked}">
                                            <StackPanel Orientation="Horizontal"
                                                    Margin="0,0,0,12">
                                                <TextBlock Text="温度:"
                                                        Width="80"
                                                        VerticalAlignment="Center"
                                                        x:Name="TextBlock_OpenAI_Temperature"
                                                        Foreground="{StaticResource PrimaryTextBrush}"
                                                        FontSize="14"/>
                                                <Slider x:Name="Slider_OpenAI_Temperature"
                                                        Minimum="0"
                                                        Maximum="2"
                                                        Width="125"
                                                        Margin="10,0"
                                                        VerticalAlignment="Center"/>
                                                <TextBlock x:Name="TextBlock_OpenAI_TemperatureValue"
                                                        Width="40"
                                                        VerticalAlignment="Center"
                                                        Foreground="{StaticResource SecondaryTextBrush}"
                                                        FontSize="14"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal"
                                                    Margin="0,0,0,0">
                                                <TextBlock Text="最大Token:"
                                                        Width="80"
                                                        VerticalAlignment="Center"
                                                        x:Name="TextBlock_OpenAI_MaxTokens"
                                                        Foreground="{StaticResource PrimaryTextBrush}"
                                                        FontSize="14"/>
                                                <TextBox x:Name="TextBox_OpenAI_MaxTokens"
                                                        Width="125"
                                                        Margin="10,0"
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource ModernTextBox}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </ScrollViewer>
                        </TabItem>
                        <TabItem Header="Gemini"
                                x:Name="Tab_Gemini"
                                Style="{StaticResource ModernTabItem}">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <Border Style="{StaticResource CardContainer}">
                                    <StackPanel Style="{StaticResource SettingGroup}">
                                        <Label Content="API 密钥"
                                                x:Name="Label_GeminiApiKey"
                                                Style="{StaticResource SettingLabel}"/>
                                        <TextBox x:Name="TextBox_GeminiApiKey"
                                                Margin="0,0,0,16"
                                                Style="{StaticResource ModernTextBox}"/>
                                        <Label Content="模型"
                                                x:Name="Label_GeminiModel"
                                                Style="{StaticResource SettingLabel}"/>
                                        <Grid Margin="0,0,0,16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <ComboBox x:Name="ComboBox_GeminiModel"
                                                    Grid.Column="0"
                                                    IsEditable="True"
                                                    Style="{StaticResource ModelComboBox}"/>
                                            <Button x:Name="Button_RefreshGeminiModels"
                                                    Grid.Column="1"
                                                    Content="刷新"
                                                    Click="Button_RefreshGeminiModels_Click"
                                                    Margin="10,0,0,0"
                                                    Style="{StaticResource SecondaryButton}"/>
                                        </Grid>
                                        <Label Content="API 地址"
                                                x:Name="Label_GeminiUrl"
                                                Style="{StaticResource SettingLabel}"/>
                                        <TextBox x:Name="TextBox_GeminiUrl"
                                                Margin="0,0,0,8"
                                                Style="{StaticResource ModernTextBox}"/>
                                        <TextBlock Text="注意：请提供正确的 API 端点 URL。"
                                                TextWrapping="Wrap"
                                                Foreground="{StaticResource SecondaryTextBrush}"
                                                x:Name="TextBlock_GeminiApiEndpointNote"
                                                FontSize="12"
                                                Margin="0,0,0,16"/>
                                        <CheckBox x:Name="CheckBox_Gemini_EnableAdvanced"
                                                Content="启用高级配置"
                                                Margin="0,0,0,16"
                                                Style="{StaticResource ModernCheckBox}"/>
                                        <StackPanel x:Name="StackPanel_Gemini_Advanced"
                                                Margin="20,0,0,0"
                                                IsEnabled="{Binding ElementName=CheckBox_Gemini_EnableAdvanced, Path=IsChecked}">
                                            <StackPanel Orientation="Horizontal"
                                                    Margin="0,0,0,12">
                                                <TextBlock Text="温度:"
                                                        Width="80"
                                                        VerticalAlignment="Center"
                                                        x:Name="TextBlock_Gemini_Temperature"
                                                        Foreground="{StaticResource PrimaryTextBrush}"
                                                        FontSize="14"/>
                                                <Slider x:Name="Slider_Gemini_Temperature"
                                                        Minimum="0"
                                                        Maximum="2"
                                                        Width="125"
                                                        Margin="10,0"
                                                        VerticalAlignment="Center"/>
                                                <TextBlock x:Name="TextBlock_Gemini_TemperatureValue"
                                                        Width="40"
                                                        VerticalAlignment="Center"
                                                        Foreground="{StaticResource SecondaryTextBrush}"
                                                        FontSize="14"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal"
                                                    Margin="0,0,0,0">
                                                <TextBlock Text="最大Token:"
                                                        Width="80"
                                                        VerticalAlignment="Center"
                                                        x:Name="TextBlock_Gemini_MaxTokens"
                                                        Foreground="{StaticResource PrimaryTextBrush}"
                                                        FontSize="14"/>
                                                <TextBox x:Name="TextBox_Gemini_MaxTokens"
                                                        Width="125"
                                                        Margin="10,0"
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource ModernTextBox}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </ScrollViewer>
                        </TabItem>
                        <TabItem Header="免费接口"
                                x:Name="Tab_Free"
                                Style="{StaticResource ModernTabItem}">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <Border Style="{StaticResource CardContainer}">
                                    <StackPanel Style="{StaticResource SettingGroup}">

                                        <CheckBox x:Name="CheckBox_Free_EnableAdvanced"
                                                Content="启用高级配置"
                                                Margin="0,0,0,16"
                                                Style="{StaticResource ModernCheckBox}"/>
                                        <StackPanel x:Name="StackPanel_Free_Advanced"
                                                Margin="20,0,0,0"
                                                IsEnabled="{Binding ElementName=CheckBox_Free_EnableAdvanced, Path=IsChecked}">
                                            <StackPanel Orientation="Horizontal"
                                                    Margin="0,0,0,12">
                                                <TextBlock Text="温度:"
                                                        Width="80"
                                                        VerticalAlignment="Center"
                                                        x:Name="TextBlock_Free_Temperature"
                                                        Foreground="{StaticResource PrimaryTextBrush}"
                                                        FontSize="14"/>
                                                <Slider x:Name="Slider_Free_Temperature"
                                                        Minimum="0"
                                                        Maximum="2"
                                                        Width="125"
                                                        Margin="10,0"
                                                        VerticalAlignment="Center"/>
                                                <TextBlock x:Name="TextBlock_Free_TemperatureValue"
                                                        Width="40"
                                                        VerticalAlignment="Center"
                                                        Foreground="{StaticResource SecondaryTextBrush}"
                                                        FontSize="14"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal"
                                                    Margin="0,0,0,0">
                                                <TextBlock Text="最大Token:"
                                                        Width="80"
                                                        VerticalAlignment="Center"
                                                        x:Name="TextBlock_Free_MaxTokens"
                                                        Foreground="{StaticResource PrimaryTextBrush}"
                                                        FontSize="14"/>
                                                <TextBox x:Name="TextBox_Free_MaxTokens"
                                                        Width="125"
                                                        Margin="10,0"
                                                        VerticalAlignment="Center"
                                                        Style="{StaticResource ModernTextBox}"/>
                                            </StackPanel>
                                            <TextBlock x:Name="TextBlock_ApiServiceNotice" Foreground="{StaticResource SecondaryTextBrush}" FontSize="12" TextWrapping="Wrap" Margin="0,8,0,0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </ScrollViewer>
                        </TabItem>
                    </TabControl>
                </Grid>
            </TabItem>
            <TabItem Header="代理"
                    x:Name="Tab_Proxy"
                    Style="{StaticResource ModernTabItem}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Border Style="{StaticResource CardContainer}">
                        <StackPanel Style="{StaticResource SettingGroup}">
                            <CheckBox x:Name="CheckBox_Proxy_IsEnabled"
                                    Content="启用代理"
                                    Margin="0,0,0,16"
                                    Style="{StaticResource ModernCheckBox}"/>
                            <StackPanel Margin="20,0,0,0"
                                    IsEnabled="{Binding ElementName=CheckBox_Proxy_IsEnabled, Path=IsChecked}">
                                <CheckBox x:Name="CheckBox_Proxy_FollowSystemProxy"
                                        Content="跟随系统代理"
                                        Margin="0,0,0,16"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <StackPanel IsEnabled="{Binding ElementName=CheckBox_Proxy_FollowSystemProxy, Path=IsChecked, Converter={StaticResource BoolInverter}}">
                                    <Label Content="协议"
                                            x:Name="Label_Proxy_Protocol"
                                            Style="{StaticResource SettingLabel}"/>
                                    <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,16">
                                        <RadioButton x:Name="RadioButton_Proxy_Http"
                                                Content="HTTP"
                                                GroupName="ProxyProtocol"
                                                IsChecked="True"
                                                Style="{StaticResource ModernRadioButton}"/>
                                        <RadioButton x:Name="RadioButton_Proxy_Socks"
                                                Content="SOCKS5"
                                                GroupName="ProxyProtocol"
                                                Margin="20,0,0,0"
                                                Style="{StaticResource ModernRadioButton}"/>
                                    </StackPanel>
                                    <Label Content="代理地址"
                                            x:Name="Label_Proxy_Address"
                                            Style="{StaticResource SettingLabel}"/>
                                    <TextBox x:Name="TextBox_Proxy_Address"
                                            Margin="0,0,0,16"
                                            Style="{StaticResource ModernTextBox}"/>
                                </StackPanel>
                                <Label Content="代理范围"
                                        Margin="0,8,0,0"
                                        x:Name="Label_Proxy_Scope"
                                        Style="{StaticResource SettingLabel}"/>
                                <CheckBox x:Name="CheckBox_Proxy_ForAllAPI"
                                        Content="全部API代理"
                                        Margin="0,0,0,12"
                                        IsChecked="True"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <StackPanel Margin="20,0,0,0"
                                        IsEnabled="{Binding ElementName=CheckBox_Proxy_ForAllAPI, Path=IsChecked, Converter={StaticResource BoolInverter}}">
                                    <CheckBox x:Name="CheckBox_Proxy_ForOllama"
                                            Content="Ollama"
                                            Margin="0,0,0,8"
                                            IsChecked="True"
                                            Style="{StaticResource ModernCheckBox}"/>
                                    <CheckBox x:Name="CheckBox_Proxy_ForOpenAI"
                                            Content="OpenAI"
                                            Margin="0,0,0,8"
                                            IsChecked="True"
                                            Style="{StaticResource ModernCheckBox}"/>
                                    <CheckBox x:Name="CheckBox_Proxy_ForGemini"
                                            Content="Gemini"
                                            Margin="0,0,0,8"
                                            IsChecked="True"
                                            Style="{StaticResource ModernCheckBox}"/>
                                    <CheckBox x:Name="CheckBox_Proxy_ForFree"
                                            Content="免费接口"
                                            Margin="0,0,0,8"
                                            IsChecked="True"
                                            Style="{StaticResource ModernCheckBox}"/>
                                </StackPanel>
                                <CheckBox x:Name="CheckBox_Proxy_ForTTS"
                                        Content="TTS"
                                        Margin="0,0,0,12"
                                        IsChecked="True"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <CheckBox x:Name="CheckBox_Proxy_ForMcp"
                                        Content="MCP"
                                        Margin="0,0,0,8"
                                        IsChecked="True"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <CheckBox x:Name="CheckBox_Proxy_ForPlugin"
                                        Content="插件商店"
                                        Margin="0,0,0,16"
                                        IsChecked="True"
                                        Style="{StaticResource ModernCheckBox}"/>
                                
                                <!-- 插件商店代理设置 - 独立区域 -->
                                <Label Content="插件商店代理设置"
                                        Margin="0,16,0,0"
                                        x:Name="Label_PluginStore_Proxy"
                                        Style="{StaticResource SettingLabel}"/>
                                <CheckBox x:Name="CheckBox_PluginStore_UseProxy"
                                        Content="启用插件商店代理"
                                        Margin="0,0,0,12"
                                        IsChecked="True"
                                        IsEnabled="{Binding ElementName=CheckBox_Proxy_IsEnabled, Path=IsChecked}"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <StackPanel Margin="20,0,0,0"
                                        IsEnabled="{Binding ElementName=CheckBox_PluginStore_UseProxy, Path=IsChecked}">
                                    <Label Content="代理地址"
                                            x:Name="Label_PluginStore_ProxyUrl"
                                            Style="{StaticResource SettingLabel}"/>
                                    <TextBox x:Name="TextBox_PluginStore_ProxyUrl"
                                            Margin="0,0,0,8"
                                            Style="{StaticResource ModernTextBox}"/>
                                    <TextBlock Text="示例: https://ghfast.top (用于加速GitHub访问)"
                                            TextWrapping="Wrap"
                                            Foreground="{StaticResource SecondaryTextBrush}"
                                            x:Name="TextBlock_PluginStore_ProxyUrlNote"
                                            FontSize="12"
                                            Margin="0,0,0,0"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </ScrollViewer>
            </TabItem>
            <TabItem Header="TTS语音"
                    x:Name="Tab_TTS"
                    Style="{StaticResource ModernTabItem}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <ScrollViewer Grid.Column="0"
                            VerticalScrollBarVisibility="Auto">
                        <Border Style="{StaticResource CardContainer}" Margin="0,0,10,0">
                            <StackPanel Style="{StaticResource SettingGroup}">
                                <CheckBox x:Name="CheckBox_TTS_IsEnabled"
                                        Content="启用TTS语音合成"
                                        Margin="0,0,0,16"
                                        Style="{StaticResource ModernCheckBox}"/>

                                <StackPanel IsEnabled="{Binding ElementName=CheckBox_TTS_IsEnabled, Path=IsChecked}">
                                    <Label Content="TTS 提供商"
                                            x:Name="Label_TTS_Provider"
                                            Style="{StaticResource SettingLabel}"/>
                                    <ComboBox x:Name="ComboBox_TTS_Provider"
                                            Margin="0,0,0,16"
                                            SelectionChanged="ComboBox_TTS_Provider_SelectionChanged"
                                            Style="{StaticResource ModernComboBox}">
                                        <ComboBoxItem Content="URL" Tag="URL" IsSelected="True"/>
                                        <ComboBoxItem Content="OpenAI" Tag="OpenAI"/>
                                        <ComboBoxItem Content="DIY" Tag="DIY"/>
                                        <ComboBox.ItemContainerStyle>
                                            <Style TargetType="ComboBoxItem" BasedOn="{StaticResource {x:Type ComboBoxItem}}">
                                                <Setter Property="Padding" Value="12,8"/>
                                                <Setter Property="FontSize" Value="14"/>
                                                <Setter Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate>
                                                            <StackPanel Orientation="Horizontal">
                                                                <Border x:Name="ItemIcon"
                                                                        Background="{StaticResource AccentBrush}"
                                                                        CornerRadius="3"
                                                                        Width="18"
                                                                        Height="18"
                                                                        Margin="0,0,8,0">
                                                                    <TextBlock x:Name="ItemIconText"
                                                                            Text="🔊"
                                                                            FontSize="9"
                                                                            Foreground="White"
                                                                            HorizontalAlignment="Center"
                                                                            VerticalAlignment="Center"/>
                                                                </Border>
                                                                <TextBlock Text="{Binding}"
                                                                        VerticalAlignment="Center"/>
                                                            </StackPanel>
                                                            <DataTemplate.Triggers>
                                                                <DataTrigger Binding="{Binding}" Value="URL">
                                                                    <Setter TargetName="ItemIconText" Property="Text" Value="🌐"/>
                                                                    <Setter TargetName="ItemIcon" Property="Background" Value="#FF6B35"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding}" Value="OpenAI">
                                                                    <Setter TargetName="ItemIconText" Property="Text" Value="AI"/>
                                                                    <Setter TargetName="ItemIcon" Property="Background" Value="#10A37F"/>
                                                                </DataTrigger>
                                                            </DataTemplate.Triggers>
                                                        </DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ComboBox.ItemContainerStyle>
                                    </ComboBox>

                                    <CheckBox x:Name="CheckBox_TTS_OnlyPlayAIResponse"
                                            Content="仅播放AI回复"
                                            Margin="0,0,0,16"
                                            IsChecked="True"
                                            Style="{StaticResource ModernCheckBox}"/>

                                    <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,12">
                                        <TextBlock Text="音量:"
                                                Width="80"
                                                VerticalAlignment="Center"
                                                x:Name="TextBlock_TTS_Volume"
                                                Foreground="{StaticResource PrimaryTextBrush}"
                                                FontSize="14"/>
                                        <Slider x:Name="Slider_TTS_Volume"
                                                Minimum="0"
                                                Maximum="10"
                                                Value="1"
                                                Width="125"
                                                Margin="10,0"
                                                VerticalAlignment="Center"/>
                                        <TextBlock x:Name="TextBlock_TTS_VolumeValue"
                                                Width="40"
                                                VerticalAlignment="Center"
                                                Foreground="{StaticResource SecondaryTextBrush}"
                                                FontSize="14"/>
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,12">
                                        <TextBlock Width="80"
                                                VerticalAlignment="Center"
                                                x:Name="TextBlock_TTS_VolumeGain"
                                                Foreground="{StaticResource PrimaryTextBrush}"
                                                FontSize="14"/>
                                        <Slider x:Name="Slider_TTS_VolumeGain"
                                                Minimum="-20"
                                                Maximum="40"
                                                Value="0"
                                                Width="125"
                                                Margin="10,0"
                                                VerticalAlignment="Center"/>
                                        <TextBlock x:Name="TextBlock_TTS_VolumeGainValue"
                                                Width="50"
                                                VerticalAlignment="Center"
                                                Foreground="{StaticResource SecondaryTextBrush}"
                                                FontSize="14"/>
                                        <TextBlock Text="dB"
                                                VerticalAlignment="Center"
                                                Foreground="{StaticResource SecondaryTextBrush}"
                                                FontSize="12"
                                                Margin="2,0,0,0"/>
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal"
                                            Margin="0,0,0,16">
                                        <TextBlock Text="语速:"
                                                Width="80"
                                                VerticalAlignment="Center"
                                                x:Name="TextBlock_TTS_Speed"
                                                Foreground="{StaticResource PrimaryTextBrush}"
                                                FontSize="14"/>
                                        <Slider x:Name="Slider_TTS_Speed"
                                                Minimum="0.5"
                                                Maximum="2.0"
                                                Value="1"
                                                Width="125"
                                                Margin="10,0"
                                                VerticalAlignment="Center"/>
                                        <TextBlock x:Name="TextBlock_TTS_SpeedValue"
                                                Width="40"
                                                VerticalAlignment="Center"
                                                Foreground="{StaticResource SecondaryTextBrush}"
                                                FontSize="14"/>
                                    </StackPanel>

                                    <WrapPanel HorizontalAlignment="Right" Margin="0,0,0,0">
                                        <Button x:Name="Button_TTS_Test"
                                                Click="Button_TTS_Test_Click"
                                                Style="{StaticResource ModernButton}"/>
                                    </WrapPanel>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </ScrollViewer>

                    <ScrollViewer Grid.Column="1"
                            VerticalScrollBarVisibility="Auto">
                        <Border Style="{StaticResource CardContainer}">
                            <StackPanel Style="{StaticResource SettingGroup}">
                                <!-- URL TTS 配置 -->
                                <StackPanel x:Name="Panel_TTS_URL"
                                        Visibility="Visible">
                                    <TextBlock x:Name="TextBlock_TTS_URL_Config"
                                            Text="URL TTS 配置"
                                            Style="{StaticResource SectionHeader}"
                                            Margin="0,0,0,16"/>

                                    <Label x:Name="Label_TTS_URL_BaseUrl"
                                            Style="{StaticResource SettingLabel}"/>
                                    <TextBox x:Name="TextBox_TTS_URL_BaseUrl"
                                            Text="https://www.example.com"
                                            Margin="0,0,0,16"
                                            Style="{StaticResource ModernTextBox}"/>

                                    <Label x:Name="Label_TTS_URL_Voice"
                                            Style="{StaticResource SettingLabel}"/>
                                    <TextBox x:Name="TextBox_TTS_URL_Voice"
                                            Text="36"
                                            Margin="0,0,0,8"
                                            Style="{StaticResource ModernTextBox}"/>
                                    <TextBlock Text="请输入语音模型ID，用于切换不同的语音模型（如：36为女声1，37为男声1等）"
                                            x:Name="TextBlock_TTS_URL_Voice_Tip"
                                            Style="{StaticResource DescriptionText}"
                                            Margin="0,0,0,16"/>

                                    <Label x:Name="Label_TTS_URL_RequestMethod"
                                            Style="{StaticResource SettingLabel}"/>
                                    <ComboBox x:Name="ComboBox_TTS_URL_RequestMethod"
                                            Margin="0,0,0,16"
                                            Style="{StaticResource ModernComboBox}">
                                        <ComboBoxItem Content="GET" Tag="GET" IsSelected="True"/>
                                        <ComboBoxItem Content="POST" Tag="POST"/>
                                    </ComboBox>

                                    <TextBlock Text="URL TTS支持GET和POST请求方法，支持多种语音类型。"
                                            x:Name="TextBlock_TTS_URL_Description"
                                            Style="{StaticResource DescriptionText}"
                                            Margin="0,0,0,16"/>
                                </StackPanel>

                                <!-- OpenAI TTS 配置 -->
                                <StackPanel x:Name="Panel_TTS_OpenAI"
                                        Visibility="Collapsed">
                                    <TextBlock x:Name="TextBlock_TTS_OpenAI_Config"
                                            Text="OpenAI TTS 配置"
                                            Style="{StaticResource SectionHeader}"
                                            Margin="0,0,0,16"/>

                                    <Label x:Name="Label_TTS_OpenAI_BaseUrl"
                                            Style="{StaticResource SettingLabel}"/>
                                    <TextBox x:Name="TextBox_TTS_OpenAI_BaseUrl"
                                            Text="https://api.fish.audio/v1/tts"
                                            Margin="0,0,0,8"
                                            Style="{StaticResource ModernTextBox}"/>
                                    <TextBlock Text="请输入完整的TTS API地址，包含完整路径（如：https://api.fish.audio/v1/tts）"
                                            x:Name="TextBlock_TTS_OpenAI_BaseUrl_Tip"
                                            Style="{StaticResource DescriptionText}"
                                            Margin="0,0,0,16"/>

                                    <Label x:Name="Label_TTS_OpenAI_ApiKey"
                                            Style="{StaticResource SettingLabel}"/>
                                    <TextBox x:Name="TextBox_TTS_OpenAI_ApiKey"
                                            Margin="0,0,0,16"
                                            Style="{StaticResource ModernTextBox}"/>

                                    <Label x:Name="Label_TTS_OpenAI_Model"
                                            Style="{StaticResource SettingLabel}"/>
                                    <Grid Margin="0,0,0,16">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ComboBox x:Name="ComboBox_TTS_OpenAI_Model"
                                                Grid.Column="0"
                                                IsEditable="True"
                                                Text="tts-1"
                                                Margin="0,0,8,0"
                                                Style="{StaticResource ModernComboBox}"/>
                                        <Button x:Name="Button_TTS_OpenAI_RefreshModels"
                                                Grid.Column="1"
                                                Content="刷新"
                                                Click="Button_TTS_OpenAI_RefreshModels_Click"
                                                Style="{StaticResource SecondaryButton}"
                                                Padding="8,4"
                                                FontSize="12"/>
                                    </Grid>

                                    <Label x:Name="Label_TTS_OpenAI_Voice"
                                            Style="{StaticResource SettingLabel}"/>
                                    <ComboBox x:Name="ComboBox_TTS_OpenAI_Voice"
                                            Margin="0,0,0,16"
                                            Style="{StaticResource ModernComboBox}">
                                        <ComboBoxItem Content="alloy" Tag="alloy" IsSelected="True"/>
                                        <ComboBoxItem Content="echo" Tag="echo"/>
                                        <ComboBoxItem Content="fable" Tag="fable"/>
                                        <ComboBoxItem Content="onyx" Tag="onyx"/>
                                        <ComboBoxItem Content="nova" Tag="nova"/>
                                        <ComboBoxItem Content="shimmer" Tag="shimmer"/>
                                    </ComboBox>

                                    <Label x:Name="Label_TTS_OpenAI_Format"
                                            Style="{StaticResource SettingLabel}"/>
                                    <ComboBox x:Name="ComboBox_TTS_OpenAI_Format"
                                            Margin="0,0,0,16"
                                            Style="{StaticResource ModernComboBox}">
                                        <ComboBoxItem Content="mp3" Tag="mp3" IsSelected="True"/>
                                        <ComboBoxItem Content="opus" Tag="opus"/>
                                        <ComboBoxItem Content="aac" Tag="aac"/>
                                        <ComboBoxItem Content="flac" Tag="flac"/>
                                    </ComboBox>

                                    <TextBlock Text="支持OpenAI TTS API格式的服务，如fish.audio等。需要提供有效的API Key。"
                                            x:Name="TextBlock_TTS_OpenAI_Description"
                                            Style="{StaticResource DescriptionText}"
                                            Margin="0,0,0,16"/>
                                </StackPanel>
                                <!-- DIY TTS 配置 -->
                                <StackPanel x:Name="Panel_TTS_DIY"
                                        Visibility="Collapsed">
                                    <TextBlock x:Name="TextBlock_TTS_DIY_Config"
                                            Text="DIY TTS 配置"
                                            Style="{StaticResource SectionHeader}"
                                            Margin="0,0,0,16"/>

                                    <TextBlock x:Name="TextBlock_TTS_DIY_Description"
                                            Text="DIY TTS 使用 JSON 配置文件进行配置，支持强大的自定义功能。"
                                            Style="{StaticResource DescriptionText}"
                                            Margin="0,0,0,16"/>

                                    <Button x:Name="Button_TTS_DIY_OpenConfig"
                                            Content="打开配置文件夹"
                                            Click="Button_TTS_DIY_OpenConfig_Click"
                                            Margin="0,0,0,16"
                                            Style="{StaticResource ModernButton}"/>

                                    <TextBlock x:Name="TextBlock_TTS_DIY_ConfigLocation"
                                            Text="配置文件位置: 文档\VPetLLM\DiyTTS\Config.json"
                                            Style="{StaticResource DescriptionText}"
                                            Margin="0,0,0,8"/>

                                    <TextBlock x:Name="TextBlock_TTS_DIY_Features"
                                            Text="支持自定义请求头、请求体、请求方法等参数。User-Agent 将自动限制为 VPetLLM。"
                                            Style="{StaticResource DescriptionText}"
                                            Margin="0,0,0,16"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </ScrollViewer>
                </Grid>
            </TabItem>
            <TabItem Header="语言"
                    x:Name="Tab_Language"
                    Style="{StaticResource ModernTabItem}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Border Style="{StaticResource CardContainer}">
                        <StackPanel Style="{StaticResource SettingGroup}">
                            <Label Content="界面语言"
                                    x:Name="Label_Language"
                                    Style="{StaticResource SettingLabel}"/>
                            <ComboBox x:Name="ComboBox_Language"
                                    Margin="0,0,0,16"
                                    Style="{StaticResource LanguageComboBox}"/>
                            <Label Content="AI提示词语言"
                                    x:Name="Label_PromptLanguage"
                                    Style="{StaticResource SettingLabel}"/>
                            <ComboBox x:Name="ComboBox_PromptLanguage"
                                    Margin="0,0,0,8"
                                    Style="{StaticResource LanguageComboBox}"/>
                            <TextBlock x:Name="TextBlock_PromptLanguageTooltip"
                                    TextWrapping="Wrap"
                                    Foreground="{StaticResource SecondaryTextBrush}"
                                    FontSize="12"
                                    Margin="0,0,0,0"/>
                        </StackPanel>
                    </Border>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="高级选项"
                    x:Name="Tab_Advanced"
                    Style="{StaticResource ModernTabItem}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Border Style="{StaticResource CardContainer}">
                        <StackPanel Style="{StaticResource SettingGroup}">
                            <CheckBox x:Name="CheckBox_EnableAction"
                                    Content="启动智能桌面宠物"
                                    Margin="0,0,0,16"
                                    IsChecked="True"
                                    Style="{StaticResource ModernCheckBox}">
                                <CheckBox.ToolTip>
                                    <ToolTip>
                                        <TextBlock Text="启用此功能会增加 Token 消耗，因为它会向 AI 发送额外的数据。"/>
                                    </ToolTip>
                                </CheckBox.ToolTip>
                            </CheckBox>
                            <StackPanel Margin="20,0,0,0">
                                <CheckBox x:Name="CheckBox_EnableBuy"
                                        Content="允许宠物购买东西"
                                        IsEnabled="{Binding IsChecked, ElementName=CheckBox_EnableAction}"
                                        IsChecked="True"
                                        Margin="0,0,0,8"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <CheckBox x:Name="CheckBox_EnableState"
                                        Content="允许获取宠物状态"
                                        IsEnabled="{Binding IsChecked, ElementName=CheckBox_EnableAction}"
                                        IsChecked="True"
                                        Margin="0,0,0,8"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <CheckBox x:Name="CheckBox_EnableActionExecution"
                                        Content="允许宠物执行动作"
                                        IsEnabled="{Binding IsChecked, ElementName=CheckBox_EnableAction}"
                                        IsChecked="True"
                                        Margin="0,0,0,8"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <CheckBox x:Name="CheckBox_EnableMove"
                                        Content="允许宠物移动"
                                        IsEnabled="{Binding IsChecked, ElementName=CheckBox_EnableAction}"
                                        IsChecked="True"
                                        Margin="0,0,0,8"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <CheckBox x:Name="CheckBox_EnableTime"
                                        Content="允许获取当前时间"
                                        IsEnabled="{Binding IsChecked, ElementName=CheckBox_EnableAction}"
                                        IsChecked="True"
                                        Margin="0,0,0,16"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <CheckBox x:Name="CheckBox_EnableHistoryCompression"
                                        Content="启用聊天记录压缩"
                                        Margin="0,0,0,12"
                                        Style="{StaticResource ModernCheckBox}"/>
                                <StackPanel Orientation="Horizontal"
                                        Margin="20,0,0,0">
                                    <TextBlock Text="压缩阈值:"
                                            VerticalAlignment="Center"
                                            x:Name="TextBlock_HistoryCompressionThreshold"
                                            Foreground="{StaticResource PrimaryTextBrush}"
                                            FontSize="14"
                                            Width="80"/>
                                    <TextBox x:Name="TextBox_HistoryCompressionThreshold"
                                            Width="110"
                                            Margin="10,0"
                                            Style="{StaticResource ModernTextBox}"/>
                                    <TextBlock Text="当前上下文长度:"
                                            VerticalAlignment="Center"
                                            Margin="20,0,5,0"
                                            x:Name="TextBlock_CurrentContextLengthLabel"
                                            Foreground="{StaticResource PrimaryTextBrush}"
                                            FontSize="14"/>
                                    <TextBlock x:Name="TextBlock_CurrentContextLength"
                                            VerticalAlignment="Center"
                                            Foreground="{StaticResource SecondaryTextBrush}"
                                            FontSize="14"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- 身体交互设置 -->
                            <Separator Margin="0,20,0,20" 
                                     Background="{StaticResource BorderBrush}" 
                                     Height="1"/>
                            <TextBlock Name="TextBlock_TouchFeedbackTitle"
                                     Text="身体交互设置" 
                                     FontSize="16" 
                                     FontWeight="SemiBold" 
                                     Margin="0,0,0,16"
                                     Foreground="{StaticResource PrimaryTextBrush}"/>
                            <ContentPresenter x:Name="TouchFeedbackSettingsContainer"/>
                        </StackPanel>
                    </Border>
                </ScrollViewer>
            </TabItem>
            <TabItem Header="工具列表"
                    x:Name="Tab_Tools"
                    Style="{StaticResource ModernTabItem}">
                <Border Style="{StaticResource CardContainer}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- 工具管理头部 -->
                        <Border Background="{StaticResource ControlBackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="20,16"
                                Margin="0,0,0,20">
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock x:Name="TextBlock_ToolsManagement"
                                        Text="工具管理"
                                        FontSize="18"
                                        FontWeight="SemiBold"
                                        Foreground="{StaticResource PrimaryTextBrush}"
                                        Margin="0,0,0,4"/>
                                <TextBlock x:Name="TextBlock_ToolsManagementDescription"
                                        Text="配置和管理您的AI工具。添加自定义API端点和工具配置。"
                                        Foreground="{StaticResource SecondaryTextBrush}"
                                        FontSize="13"/>
                            </StackPanel>
                        </Border>

                        <!-- 工具列表 -->
                        <Border Background="White"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Grid.Row="1">
                            <DataGrid x:Name="DataGrid_Tools"
                                    AutoGenerateColumns="False"
                                    CanUserAddRows="False"
                                    RowHeight="70"
                                    GridLinesVisibility="Horizontal"
                                    HeadersVisibility="Column"
                                    AlternatingRowBackground="#FAFBFC"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Style="{StaticResource ModernDataGrid}"
                                    ColumnHeaderStyle="{StaticResource ModernDataGridColumnHeader}">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header=""
                                    Binding="{Binding Name}"
                                    Width="120"
                                    MinWidth="100">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Padding" Value="12,8"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                                <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                                                <Setter Property="VerticalAlignment" Value="Center"/>
                                                <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header=""
                                    Binding="{Binding Url}"
                                    Width="200"
                                    MinWidth="150">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Padding" Value="12,8"/>
                                                <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                                                <Setter Property="VerticalAlignment" Value="Center"/>
                                                <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                                <Setter Property="ToolTip" Value="{Binding Url}"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header=""
                                    Binding="{Binding ApiKey}"
                                    Width="150"
                                    MinWidth="120">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Padding" Value="12,8"/>
                                                <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}"/>
                                                <Setter Property="VerticalAlignment" Value="Center"/>
                                                <Setter Property="FontFamily" Value="Consolas"/>
                                                <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                                <Setter Property="ToolTip" Value="{Binding ApiKey}"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header=""
                                    Binding="{Binding Description}"
                                    Width="*"
                                    MinWidth="200">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Padding" Value="12,8"/>
                                                <Setter Property="TextWrapping" Value="Wrap"/>
                                                <Setter Property="VerticalAlignment" Value="Center"/>
                                                <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                                                <Setter Property="LineHeight" Value="18"/>
                                                <Setter Property="MaxHeight" Value="44"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTemplateColumn Header="启用"
                                    Width="80">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Grid HorizontalAlignment="Stretch" 
                                                  VerticalAlignment="Stretch">
                                                    <CheckBox IsChecked="{Binding IsEnabled, UpdateSourceTrigger=PropertyChanged}"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Margin="0"
                                                    Style="{StaticResource ModernCheckBox}"/>
                                                </Grid>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.HeaderStyle>
                                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource ModernDataGridColumnHeader}">
                                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTemplateColumn.HeaderStyle>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Border>

                        <!-- 底部操作区域 -->
                        <Border Background="{StaticResource ControlBackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="20,12"
                                Grid.Row="2"
                                Margin="0,20,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                    <TextBlock x:Name="TextBlock_MCPToolsConfig"
                                            Text="MCP 工具配置"
                                            FontWeight="Medium"
                                            Foreground="{StaticResource PrimaryTextBrush}"
                                            FontSize="14"
                                            Margin="0,0,0,2"/>
                                    <TextBlock Text="此列表用于配置 MCP (Model-Controlled Plugin) 工具"
                                            x:Name="TextBlock_ToolsDescription"
                                            Foreground="{StaticResource SecondaryTextBrush}"
                                            FontSize="12"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" 
                                           Orientation="Horizontal" 
                                           VerticalAlignment="Center">
                                    <Button Content="➕ 添加"
                                            Click="Button_AddTool_Click"
                                            Margin="0,0,12,0"
                                            Padding="16,8"
                                            x:Name="Button_AddTool"
                                            Style="{StaticResource PrimaryButton}"/>
                                    <Button Content="🗑️ 删除"
                                            Click="Button_DeleteTool_Click"
                                            Padding="16,8"
                                            x:Name="Button_DeleteTool"
                                            Style="{StaticResource SecondaryButton}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>
            </TabItem>
            <TabItem Header="日志"
                    x:Name="Tab_Log"
                    Style="{StaticResource ModernTabItem}">
                <Border Style="{StaticResource CardContainer}">
                    <DockPanel>
                        <StackPanel DockPanel.Dock="Top"
                                Orientation="Horizontal"
                                HorizontalAlignment="Left"
                                Margin="0,0,0,16">
                            <CheckBox x:Name="CheckBox_LogAutoScroll"
                                    Content="自动滚动"
                                    Margin="0,0,20,0"
                                    Style="{StaticResource ModernCheckBox}"/>
                            <TextBlock Text="最大日志数量:"
                                    VerticalAlignment="Center"
                                    Margin="0,0,8,0"
                                    x:Name="TextBlock_MaxLogCount"
                                    Foreground="{StaticResource PrimaryTextBrush}"
                                    FontSize="14"/>
                            <TextBox x:Name="TextBox_MaxLogCount"
                                    Width="185"
                                    VerticalAlignment="Center"
                                    Style="{StaticResource ModernTextBox}"/>
                        </StackPanel>
                        <StackPanel DockPanel.Dock="Bottom"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,16,0,0">
                            <Button x:Name="Button_CopyLog"
                                    Content="复制"
                                    Click="Button_CopyLog_Click"
                                    Margin="0,0,8,0"
                                    Style="{StaticResource SecondaryButton}"/>
                            <Button x:Name="Button_ClearLog"
                                    Content="清空"
                                    Click="Button_ClearLog_Click"
                                    Style="{StaticResource SecondaryButton}"/>
                        </StackPanel>
                        <ListBox x:Name="LogBox"
                                MinHeight="200"
                                Background="{StaticResource BackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1"/>
                    </DockPanel>
                </Border>
            </TabItem>
            <TabItem Header="插件商店"
                    x:Name="Tab_Plugin"
                    Style="{StaticResource ModernTabItem}">
                <Border Style="{StaticResource CardContainer}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- 简化的插件管理头部 -->
                        <Border Background="{StaticResource ControlBackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="16,12"
                                Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- 标题区域 -->
                                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                    <TextBlock x:Name="TextBlock_PluginManagementCenter"
                                            Text="插件管理"
                                            FontSize="16"
                                            FontWeight="SemiBold"
                                            Foreground="{StaticResource PrimaryTextBrush}"
                                            Margin="0,0,0,2"/>
                                    <TextBlock x:Name="TextBlock_HowToUse"
                                            Foreground="{StaticResource SecondaryTextBrush}"
                                            FontSize="12"/>
                                </StackPanel>

                                <!-- 操作按钮 -->
                                <StackPanel Grid.Column="1" 
                                           Orientation="Horizontal" 
                                           VerticalAlignment="Center">
                                    <Button x:Name="Button_RefreshPlugins"
                                            Content="刷新"
                                            Margin="0,0,8,0"
                                            Padding="12,6"
                                            Click="Button_RefreshPlugins_Click"
                                            Style="{StaticResource SecondaryButton}"/>
                                    <Button x:Name="Button_ImportPlugin"
                                            Content="导入插件"
                                            Padding="12,6"
                                            Click="Button_ImportPlugin_Click"
                                            Style="{StaticResource PrimaryButton}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                        <!-- 简化的插件列表容器 -->
                        <Border Background="{StaticResource ControlBackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Grid.Row="1">
                            <DataGrid x:Name="DataGrid_Plugins"
                                    AutoGenerateColumns="False"
                                    CanUserAddRows="False"
                                    SelectionChanged="DataGrid_Plugins_SelectionChanged"
                                    RowHeight="60"
                                    GridLinesVisibility="Horizontal"
                                    HeadersVisibility="Column"
                                    AlternatingRowBackground="{StaticResource SecondaryBrush}"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    Style="{StaticResource ModernDataGrid}"
                                    ColumnHeaderStyle="{StaticResource ModernDataGridColumnHeader}"
                                    HorizontalGridLinesBrush="{StaticResource BorderBrush}"
                                    SelectionMode="Single"
                                    SelectionUnit="FullRow">
                                <DataGrid.Columns>
                                    <!-- 简化的启用状态列 -->
                                    <DataGridTemplateColumn Header="" Width="60">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <CheckBox IsChecked="{Binding IsEnabled, UpdateSourceTrigger=PropertyChanged}"
                                                         IsEnabled="{Binding IsFailed, Converter={StaticResource BoolInverter}}"
                                                         Click="PluginEnabled_Click"
                                                         HorizontalAlignment="Center"
                                                         VerticalAlignment="Center"
                                                         Style="{StaticResource ModernCheckBox}"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.HeaderStyle>
                                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource ModernDataGridColumnHeader}">
                                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTemplateColumn.HeaderStyle>
                                    </DataGridTemplateColumn>
                                    
                                    <!-- 优化的插件状态列 -->
                                    <DataGridTemplateColumn Header="" Width="80">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" 
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center">
                                                    <!-- 状态指示器 -->
                                                    <Ellipse x:Name="StatusIndicator"
                                                            Width="8"
                                                            Height="8"
                                                            Fill="#38B2AC"
                                                            Margin="0,0,6,0"
                                                            VerticalAlignment="Center"/>
                                                    
                                                    <!-- 状态文字 -->
                                                    <TextBlock x:Name="StatusTextDisplay"
                                                              Text="{Binding StatusText}"
                                                              FontSize="11"
                                                              Foreground="#38B2AC"
                                                              FontWeight="Medium"
                                                              VerticalAlignment="Center"/>
                                                </StackPanel>
                                                
                                                <DataTemplate.Triggers>
                                                    <!-- 错误状态 -->
                                                    <DataTrigger Binding="{Binding IsFailed}" Value="True">
                                                        <Setter TargetName="StatusIndicator" Property="Fill" Value="#E53E3E"/>
                                                        <Setter TargetName="StatusTextDisplay" Property="Foreground" Value="#E53E3E"/>
                                                    </DataTrigger>
                                                    
                                                    <!-- 禁用状态 -->
                                                    <DataTrigger Binding="{Binding IsEnabled}" Value="False">
                                                        <Setter TargetName="StatusIndicator" Property="Fill" Value="#A0AEC0"/>
                                                        <Setter TargetName="StatusTextDisplay" Property="Foreground" Value="#A0AEC0"/>
                                                    </DataTrigger>
                                                    
                                                    <!-- 待启动状态 -->
                                                    <MultiDataTrigger>
                                                        <MultiDataTrigger.Conditions>
                                                            <Condition Binding="{Binding IsEnabled}" Value="True"/>
                                                            <Condition Binding="{Binding IsLoaded}" Value="False"/>
                                                        </MultiDataTrigger.Conditions>
                                                        <Setter TargetName="StatusIndicator" Property="Fill" Value="#F6AD55"/>
                                                        <Setter TargetName="StatusTextDisplay" Property="Foreground" Value="#F6AD55"/>
                                                    </MultiDataTrigger>
                                                    
                                                    <!-- 正常运行状态 -->
                                                    <MultiDataTrigger>
                                                        <MultiDataTrigger.Conditions>
                                                            <Condition Binding="{Binding IsEnabled}" Value="True"/>
                                                            <Condition Binding="{Binding IsFailed}" Value="False"/>
                                                        </MultiDataTrigger.Conditions>
                                                        <Setter TargetName="StatusIndicator" Property="Fill" Value="#38B2AC"/>
                                                        <Setter TargetName="StatusTextDisplay" Property="Foreground" Value="#38B2AC"/>
                                                    </MultiDataTrigger>
                                                    
                                                    <!-- 未下载状态 (最后处理，确保优先级最高) -->
                                                    <DataTrigger Binding="{Binding IsLocal}" Value="False">
                                                        <Setter TargetName="StatusIndicator" Property="Fill" Value="#718096"/>
                                                        <Setter TargetName="StatusTextDisplay" Property="Foreground" Value="#718096"/>
                                                    </DataTrigger>
                                                </DataTemplate.Triggers>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                        <DataGridTemplateColumn.HeaderStyle>
                                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource ModernDataGridColumnHeader}">
                                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTemplateColumn.HeaderStyle>
                                    </DataGridTemplateColumn>
                                    <!-- 简化的插件信息列 -->
                                    <DataGridTemplateColumn Header="" Width="200" MinWidth="180">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Margin="8,6" VerticalAlignment="Center">
                                                    <!-- 插件名称 -->
                                                    <TextBlock Text="{Binding Name}"
                                                              FontSize="14"
                                                              FontWeight="SemiBold"
                                                              Foreground="{StaticResource PrimaryTextBrush}"
                                                              TextTrimming="CharacterEllipsis"
                                                              ToolTip="{Binding Name}"
                                                              Margin="0,0,0,2"/>
                                                    
                                                    <!-- 作者信息 -->
                                                    <TextBlock Text="{Binding Author}"
                                                              FontSize="12"
                                                              Foreground="{StaticResource SecondaryTextBrush}"
                                                              TextTrimming="CharacterEllipsis"
                                                              ToolTip="{Binding Author}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    
                                    <!-- 插件描述列 -->
                                    <DataGridTemplateColumn Header="" Width="*" MinWidth="250">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Description}"
                                                          Margin="8,6"
                                                          FontSize="12"
                                                          Foreground="{StaticResource PrimaryTextBrush}"
                                                          TextWrapping="Wrap"
                                                          TextTrimming="CharacterEllipsis"
                                                          VerticalAlignment="Center"
                                                          MaxHeight="44"
                                                          LineHeight="16"
                                                          ToolTip="{Binding Description}"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <!-- 简化的操作列 -->
                                    <DataGridTemplateColumn Header="" Width="160" MinWidth="140">
                                        <DataGridTemplateColumn.HeaderStyle>
                                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource ModernDataGridColumnHeader}">
                                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTemplateColumn.HeaderStyle>
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" 
                                                           Margin="8,6"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center">
                                                    
                                                    <!-- 主要操作按钮 -->
                                                    <Button Click="Button_PluginAction_Click" 
                                                           Content="{Binding ActionText}"
                                                           Margin="0,0,4,0"
                                                           Padding="8,4"
                                                           FontSize="12">
                                                        <Button.Style>
                                                            <Style TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                <Style.Triggers>
                                                                    <MultiDataTrigger>
                                                                        <MultiDataTrigger.Conditions>
                                                                            <Condition Binding="{Binding IsLocal}" Value="True"/>
                                                                            <Condition Binding="{Binding IsFailed}" Value="False"/>
                                                                            <Condition Binding="{Binding IsUpdatable}" Value="False"/>
                                                                        </MultiDataTrigger.Conditions>
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                    </MultiDataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>
                                                    </Button>

                                                    <!-- 设置按钮 -->
                                                    <Button Click="Button_PluginSetting_Click"
                                                           Content="{Binding SettingActionText}"
                                                           Margin="0,0,4,0"
                                                           Padding="8,4"
                                                           FontSize="12"
                                                           ToolTip="{Binding SettingActionText}">
                                                        <Button.Style>
                                                            <Style TargetType="Button" BasedOn="{StaticResource SecondaryButton}">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding HasSettingAction}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>
                                                    </Button>
                                                    
                                                    <!-- 卸载按钮 -->
                                                    <Button Click="Button_UninstallPlugin_Click"
                                                           Content="{Binding UninstallActionText}"
                                                           Padding="8,4"
                                                           FontSize="12"
                                                           ToolTip="{Binding UninstallActionText}">
                                                        <Button.Style>
                                                            <Style TargetType="Button" BasedOn="{StaticResource SecondaryButton}">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Setter Property="Foreground" Value="#E53E3E"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsLocal}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>
                                                    </Button>

                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Border>
                    </Grid>
                </Border>
            </TabItem>
        </TabControl>
    </Grid>
</Window>